<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login</title>
    <link rel="stylesheet" type="text/css" href="/static/css/bootstrap/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="/static/css/index.css">
    <link rel="stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="stylesheet" type="text/css" href="/static/css/detail.css">
    <style>
        .panel-default>.panel-heading {
            color: #333;
            background-color: #f5f5f5;
            border-color: #ddd;
        }

        .panel-heading {
            padding: 10px 15px;
            border-bottom: 1px solid transparent;
            border-top-left-radius: 3px;
            border-top-right-radius: 3px;
        }
    </style>
</head>
<body class='login'>
	<div class="container">
        <div class="row">
		    <div class="col-md-4 col-md-offset-4">
                <div class="login-panel panel panel-default" style="margin-top: 50%">

                    <div class="panel-heading">
                        <h3 class="panel-title">Please Sign In</h3>
                    </div>
                    <div class="panel-body" style="background: #fff">
                        <form class='form-validate' id="login-form">
                            <fieldset>
                                <div class="form-group">
        {#                            <div class="controls">#}
                                        <input type="text" name='username' placeholder="IDSID" class='form-control'/>
                                        <span></span>
        {#                            </div>#}
                                </div>
                                <div class="form-group">
        {#                            <div class="pw controls">#}
                                        <input type="password" name="password" placeholder="Password" class='form-control' data-rule-required="true"/>
                                        <span></span>
        {#                            </div>#}
                                </div>
                                 <div class="checkbox">
                                    <label>
                                        <input name="remember" type="checkbox" value="Remember Me">Remember Me
                                    </label>
                                </div>
                                <div class="submit">
                                    <input type="submit" value="Login" class='btn btn-lg btn-success btn-block'>
                                </div>
                            </fieldset>
                        </form>
                    </div>
                </div>
		    </div>
        </div>
	</div>

    <script type="text/javascript" src="/static/js/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="/static/js/bootstrap/bootstrap.min.js"></script>
    <script type="text/javascript" src="/static/plugins/jquery-validation/jquery.validate.min.js"></script>

    <script type="text/javascript">
    {% include 'common/csrftoken.tmp' %}
    $(function(e){
        $('input[type="submit"]').bind('keypress', function(e) {
            if(e.keyCode==13){
                $("#login-form").submit();
            }
        });
        $("#login-form").validate({
            rules:{
                user_name:{required:true},
                user_pwd:{required:true}
            },
            messages:{
                user_name:{required:"IDSID can not be null."},
                user_pwd:{required:"Password can not be null."}
            },
            errorPlacement:function(error,element){
                element.parents('.control-group ').addClass('error');
                element.next().empty().append($(error).addClass('help-block'));
            },
            errorElement: "span",
            success:function(o){
                o.parents('.error').removeClass('error')
                o.remove();
            },
            submitHandler:function(form){
                $("body").addClass("loading");
                form={'username':$('input[name="username"]').val(),'password':$('input[name="password"]').val()}
                $.post('{% url "login" %}',form,function(data){
                    if(data.result=='fail'){
                        $('.control-group ').addClass('error');
                        $('input[name="username"]').next().empty().append('<span class="error help-block">User name or password error.</span>');
                    }else if(data.result=='error'){
                        $('.control-group ').addClass('error');
                        $('input[name="password"]').next().empty().append('<span class="error help-block">Server exception, please try again later!</span>');
                    }else{
                        var redUrl = location.href+'';
                        var indexUrl = redUrl.lastIndexOf('#*redirecturl*=');
                        var accessUri = ( indexUrl>-1 ? redUrl.substring(indexUrl+15) : "{%url 'index'%}");
                        accessUri = data && data.urls ? data.urls : accessUri;
                        location.href = accessUri;
                    }
                    $("body").removeClass("loading");
                },'json');
            }
        });
    });
    </script>
<div class="login-modal"></div>
</body>
</html>